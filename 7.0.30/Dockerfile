# Beware: This file is generated by the generate.sh script!
FROM ubuntu:16.04
MAINTAINER YuYing <1021218480@qq.com>
EXPOSE 9000

ENV DEBIAN_FRONTEND noninteractive
ENV TZ=Asia/Shanghai

RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime \
        && echo $TZ > /etc/timezone \
        && dpkg-reconfigure -f noninteractive tzdata

RUN apt-get update \
        && apt-get -y dist-upgrade \
        && apt-get install -y software-properties-common language-pack-en-base language-pack-de git \
        && LC_ALL=en_US.UTF-8 add-apt-repository ppa:ondrej/php \
        && apt-get update \
        && echo "Package: *\nPin: release o=LP-PPA-ondrej-php5\nPin-Priority: 1001" > /etc/apt/preferences.d/ondrej \
        && apt-get install -y \
           php7.0-fpm \
           php7.0-sqlite3 \
           php7.0-pgsql \
           php7.0-mysql \
           php7.0-mcrypt \
           php7.0-mbstring \
           php7.0-intl \
           php7.0-gd \
           php7.0-curl \
           php7.0-xml \
           php7.0-xsl \
           php7.0-xdebug \
           php7.0-zip \
           php7.0-opcache \
           php7.0-cli \
           php7.0-tidy \
           php7.0-imap \
           php7.0-json \
           php7.0-pspell \
           php7.0-recode \
           php7.0-common \
           #php7.0-sybase \
           php7.0-bz2 \
           #php7.0-apcu-bc \
           php7.0-shmop \
           php7.0-soap \
           php7.0-pdo \
           php7.0-mysqli \
	   php7.0-mysqlnd \
           php7.0-fileinfo \
	   php7.0-imagick \
           #php7.0-dev \
	   php-memcached \
	   php-memcache \
	   php-redis \
        && apt-get install -y php-pear \
        && apt-get clean \
        && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

RUN phpenmod -v 7.0 -s ALL sqlite3 pgsql mysql mcrypt mbstring intl gd curl xml xsl xdebug zip opcache cli tidy imap json \
			   pspell recode common bz2 memcached redis shmop soap pdo mysqli mysqlnd fileinfo imagick dev

RUN usermod -u 1000 www-data
RUN usermod -g 33 www-data

# supply but disable xdebug; can be enabled by custom volume-mount ini file
RUN phpdismod -v 7.0 -s ALL xdebug

# install composer
#RUN php7.0 -r 'readfile("https://getcomposer.org/installer");' > composer-setup.php \
#       && php7.0 composer-setup.php --install-dir=/usr/local/bin --filename=composer \
#       && rm composer-setup.php

# install phing
RUN export PHP_PEAR_PHP_BIN=php7.0 \
        && pear channel-discover pear.phing.info \
        && pear install phing/phing

ADD ["so/*", "/usr/lib/php/20151012/"]

# Prepare run directory\nRUN mkdir /run/php\n\nWORKDIR /var/www\n\n" >> 7.0/fpm/Dockerfile
COPY php.ini    /etc/php/7.0/fpm/conf.d/
COPY php.ini    /etc/php/7.0/cli/conf.d/
COPY php-fpm.conf /etc/php/7.0/fpm/php-fpm.conf
CMD ["php-fpm7.0"]