# Beware: This file is generated by the generate.sh script!
FROM ubuntu:16.04
MAINTAINER YuYing <1021218480@qq.com>
EXPOSE 9000

# set system time
ENV TZ=Asia/Shanghai
RUN rm -rf /etc/localtime && ln -s /usr/share/zoneinfo/$TZ /etc/localtime

RUN apt-get update \
        && apt-get -y dist-upgrade \
        && apt-get install -y software-properties-common language-pack-en-base language-pack-de git \
        && LC_ALL=en_US.UTF-8 add-apt-repository ppa:ondrej/php \
        && apt-get update \
        && echo "Package: *\nPin: release o=LP-PPA-ondrej-php5\nPin-Priority: 1001" > /etc/apt/preferences.d/ondrej \
        && apt-get install -y \
           php7.2-fpm \
           php5.6-fpm \
           php7.2-sqlite3 \
           php7.2-pgsql \
           php7.2-mysql \
           #php7.2-mcrypt \
           php7.2-mbstring \
           php7.2-intl \
           php7.2-gd \
           php7.2-curl \
           php7.2-xml \
           php7.2-xsl \
           php7.2-xdebug \
           php7.2-zip \
           php7.2-opcache \
           php7.2-cli \
           php7.2-tidy \
           php7.2-imap \
           php7.2-json \
           php7.2-pspell \
           php7.2-recode \
           php7.2-common \
           #php7.2-sybase \
	   php7.2-bz2 \
           #php7.2-apcu-bc \
           php7.2-shmop \
           php7.2-soap \
           php7.2-pdo \
           php7.2-mysqli \
           php7.2-mysqlnd \
           php7.2-fileinfo \
           php7.2-imagick \
           #php7.2-dev \
           php-memcached \
           php-memcache \
           php-redis \
        && apt-get install -y php-pear \
        && apt-get clean \
        && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

RUN phpenmod -v 7.2 -s ALL sqlite3 pgsql mysql mcrypt mbstring intl gd curl xml xsl xdebug zip opcache cli tidy imap json \
                           pspell recode common bz2 memcached redis shmop soap pdo mysqli mysqlnd fileinfo imagick dev

RUN usermod -u 1000 www-data
RUN usermod -g 33 www-data

# supply but disable xdebug; can be enabled by custom volume-mount ini file
RUN phpdismod -v 7.2 -s ALL xdebug

# install composer
# RUN php7.2 -r 'readfile("https://getcomposer.org/installer");' > composer-setup.php \
#       && php7.2 composer-setup.php --install-dir=/usr/local/bin --filename=composer \
#       && rm composer-setup.php

# install phing
RUN export PHP_PEAR_PHP_BIN=php7.2 \
        && pear channel-discover pear.phing.info \
        && pear install phing/phing

# Prepare run directory\nRUN mkdir /run/php\n\nWORKDIR /var/www\n\n" >> 7.2/fpm/Dockerfile
COPY php.ini      /etc/php/7.2/fpm/conf.d/
COPY php.ini      /etc/php/7.2/cli/conf.d/
COPY php-fpm.conf /etc/php/7.2/fpm/php-fpm.conf
COPY php-fpm.conf /etc/php/7.2/cli/php-fpm.conf
CMD ["php-fpm7.2"]

